<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.2">
<!-- OpenMarket/Xcelerate/AssetType/Template/ContentFormElement
-
- INPUT
-
- OUTPUT
-
-->


<CALLELEMENT NAME="OpenMarket/Xcelerate/AssetType/Template/ContentFormSetVar"/>

<setvar NAME="varname" VALUE="ContentDetails:element:Variables.currentElement:elementname"/>
<if COND="IsVariable.Variables.varname=false">
<then>
	<setvar NAME="ContentDetails:element:Variables.currentElement:elementname" VALUE="Variables.ContentDetails:rootelement"/>
	<setvar NAME="ContentDetails:element:Variables.currentElement:theme" VALUE="Variables.empty"/>
	<setvar NAME="ContentDetails:element:Variables.currentElement:elementdescription" VALUE="Variables.empty"/>
	<setvar NAME="ContentDetails:element:Variables.currentElement:urlspec" VALUE="Variables.empty"/>
	<setvar NAME="ContentDetails:element:Variables.currentElement:resdetails1" VALUE="Variables.empty"/>
	<setvar NAME="ContentDetails:element:Variables.currentElement:resdetails2" VALUE="Variables.empty"/>
</then>
</if>

<!--
Set up variables ModelXml, ModelHtml, ModelHtml variables that contain 
standard CS preamble-postamble needed when creating a new Template element.
-->
<callelement NAME="OpenMarket/Xcelerate/AssetType/Template/SetModelString"/> 
<SCRIPT LANGUAGE="JavaScript">
<REPLACEALL LIST="Variables.ModelXml,Variables.ModelHtml,Variables.ModelJsp">
<![CDATA[
function getRootElement()
{
	return document.forms[0].elements['Template:rootelement'].value ;
}
function setXmlString(urlfield, themefield) {
	var modelXml = new String('Variables.ModelXml');
	var newString = modelXml.replace(/XXXX/,getRootElement);
	var obj = document.forms[0].elements[urlfield];
	if (isblank(obj.value) == true){
		obj.value =newString;
		setDefaultPath(urlfield+"spec",".xml",themefield);
	} else 
	{
		if ( confirm( ]]>"<XLAT.STREAM KEY="dvin/AT/Template/ConfirmReplaceModelXML" ESCAPE="true" ENCODE="false"/>"<![CDATA[) ) 
		{
			obj.value =newString;
			setDefaultPath(urlfield+"spec",".xml", themefield);
		}
	}
}

function setHtmlString(urlfield, themefield) {
	var modelXml = new String('Variables.ModelHtml');
	var newString = modelXml.replace(/XXXX/,getRootElement);
	var obj = document.forms[0].elements[urlfield];
	if (isblank(obj.value) == true){
		obj.value =newString;
		setDefaultPath(urlfield+"spec",".html",themefield);
	} else 
	{
		if ( confirm( ]]>"<XLAT.STREAM KEY="dvin/AT/Template/ConfirmReplaceModelHTML" ESCAPE="true" ENCODE="false"/>"<![CDATA[) ) 
		{
			obj.value =newString;
			setDefaultPath(urlfield+"spec",".html",themefield);
		}
	}
}
function setJspString(urlfield, themefield) {
	var modelXml = new String('Variables.ModelJsp');
	var newString = modelXml.replace(/XXXX/,getRootElement);
	var obj = document.forms[0].elements[urlfield];
	if (isblank(obj.value) == true){
		obj.value =newString;
		setDefaultPath(urlfield+"spec",".jsp",themefield);
	} else 
	{
		if ( confirm( ]]>"<XLAT.STREAM KEY="dvin/AT/Template/ConfirmReplaceModelJSP" ESCAPE="true" ENCODE="false"/>"<![CDATA[) ) 
		{
			obj.value =newString;
			setDefaultPath(urlfield+"spec",".jsp",themefield);
		}
	}
}


]]>
</REPLACEALL>

<![CDATA[

function setDefaultPath(objname,ext,themefield) {
	var urlspecfield = document.forms[0].elements[objname];
	var rootelement = document.forms[0].elements['Template:rootelement'].value;	
	var basefilename = rootelement.replace( /([^a-zA-Z0-9\/_])/g, "-");
	if (basefilename.substring(0,1) == "/")
		basefilename = "Typeless" + basefilename;
	var theme = document.forms[0].elements[themefield].value;
	if (!isblank(theme)) {
  		urlspecfield.value =
  			basefilename + '_' + theme + ext;
  	}
  	else {
  		urlspecfield.value =
  			basefilename + ext;
  	}
}

function checkfilename(urlfieldname,urlspecfieldname)
{
	var urlspecfield = document.forms[0].elements[urlfieldname];
	if (!isblank(urlspecfield.value))
	{
		var urlspec = document.forms[0].elements[urlspecfieldname].value;
		if ( isblank(urlspec) ) {
	      ]]>
	      alert("<XLAT.STREAM KEY="dvin/AT/Template/SpecifyFilename" ESCAPE="true" ENCODE="false"/>");
	      <![CDATA[
			return false;
		}
		else if ( urlspec.search(/['"?;:]/) != -1) {
		 	var replacestr=/\bVariables.filename\b/ ;
         var xlatstr= ']]><XLAT.STREAM KEY="dvin/AT/Template/FilenameContainsIllegalCharacters" ENCODE="false" ESCAPE="true"/><![CDATA[' ;
         alert(xlatstr.replace(replacestr,urlspec));
			return false;
		}
		else if ( urlspec.indexOf(".") == -1 ) {
		 	var replacestr=/\bVariables.filename\b/ ;
         var xlatstr= ']]><XLAT.STREAM KEY="dvin/AT/Template/FilenameHasNoExtension" ENCODE="false" ESCAPE="true"/><![CDATA[' ;
         alert(xlatstr.replace(replacestr,urlspec));
			return false;
		}
	}
}

function AddVariant(ourPage,nextstep,themefield,elementnamefield)
{
	var theme = document.forms[0].elements[themefield].value;
	if ( isblank( theme )) {
	      ]]>
	      alert("<XLAT.STREAM KEY="dvin/AT/Template/ProvideVariantName" ESCAPE="true" ENCODE="false"/>");
	      <![CDATA[
	      return false;
	}

	var total = parseInt(document.forms[0].elements['Template:element:Total'].value);
	total++;
	document.forms[0].elements['Template:element:Total'].value = total;
		
	document.forms[0].elements['currentElementName'].value = 
		document.forms[0].elements['Template:rootelement'].value + ":" + theme;
	document.forms[0].elements[elementnamefield].value = 
		document.forms[0].elements['Template:rootelement'].value + ":" + theme;

	return Fixpagename( ourPage, nextstep );
}
function editElement( ourPage,nextstep, elementname )
{
	document.forms[0].elements['currentElementName'].value = elementname;
	return Fixpagename( ourPage, nextstep );
}
	
function deleteElement( ourPage,nextstep, elementnamefield )
{
	document.forms[0].elements[elementnamefield].value = "";
	return Fixpagename( ourPage, nextstep );
}

function changeRootelement()
{
	var theme = document.forms[0].elements['Template:element:0:theme'];
	if (!isblank(theme.value))
	{
		document.forms[0].elements['Template:element:0:elementname'].value = 
			document.forms[0].elements['Template:rootelement'].value + ":" + theme.value;
	}
	else {
		document.forms[0].elements['Template:element:0:elementname'].value = 
			document.forms[0].elements['Template:rootelement'].value;
	}
}
]]>
</SCRIPT>


<table border="0" cellpadding="0" cellspacing="0">

<callelement NAME="OpenMarket/Xcelerate/AssetType/Template/ContentFormNavBar">
	<argument NAME="CurrentCat" VALUE="Element"/>
</callelement>

<tr>
<td>	
<table border="0" cellpadding="0" cellspacing="0">

<!-- ttype -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/ElementUsage"/>:</td>
	<td></td>
	<td>
		<!-- by default, the ttype=b -->
		<IF COND="Variables.updatetype=setformdefaults">
		<THEN>			
			<IF COND="Variables.ContentDetails:ttype=Variables.empty">
			<THEN>
				<IF COND="Variables.EditFlag!=copy">
				<THEN>
					<SETVAR NAME="ContentDetails:ttype" VALUE="b"/>
				</THEN>
				</IF>
			</THEN>
			</IF>
		</THEN>
		</IF>
		<SELECT NAME="Template:ttype">
			<OPTION VALUE=""/><XLAT.STREAM KEY="dvin/Common/AT/ElementUsageUnspecified"/>
			<if COND="Variables.ContentDetails:ttype=b">
			<then>
				<OPTION VALUE="b" SELECTED="true"/><XLAT.STREAM KEY="dvin/Common/AT/ElementCalledWithinHTML"/>
			</then>
			<else>
				<OPTION VALUE="b"/><XLAT.STREAM KEY="dvin/Common/AT/ElementCalledWithinHTML"/>
			</else>
			</if>			
			<if COND="Variables.ContentDetails:ttype=x">
			<then>
				<OPTION VALUE="x" SELECTED="true"/><XLAT.STREAM KEY="dvin/Common/AT/ElementCanbecalledExternally"/>
			</then>
			<else>
				<OPTION VALUE="x"/><XLAT.STREAM KEY="dvin/Common/AT/ElementCanbecalledExternally"/>
			</else>
			</if>			
			<if COND="Variables.ContentDetails:ttype=r">
			<then>
				<OPTION VALUE="r" SELECTED="true"/><XLAT.STREAM KEY="dvin/Common/AT/ElementStreamedAsRawData"/>
			</then>
			<else>
				<OPTION VALUE="r"/><XLAT.STREAM KEY="dvin/Common/AT/ElementStreamedAsRawData"/>
			</else>
			</if>	
		</SELECT>		
	</td>
</tr>

<!-- if it is a typeless template ask for called templates -->
<if COND="Variables.ContentDetails:subtype=Variables.empty">
<then>
	<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
	<tr>
		<td class="form-label-text"><XLAT.STREAM KEY="dvin/AT/Template/CalledTemplates"/>:</td>
		<td></td>
		<td>
			<!-- set up the Called templates so these can be selected in the UI -->
			<SETCOUNTER NAME="nth" VALUE="0"/>
			<if COND="Variables.ContentDetails:Called:Total!=0">
			<then>
				<LOOP COUNT="Variables.ContentDetails:Called:Total">
					<setvar NAME="varname" VALUE="isCalledVariables.ContentDetails:Called:Counters.nth"/>
					<setvar NAME="Variables.varname" VALUE="true"/>
					<INCCOUNTER NAME="nth" VALUE="1"/>
				</LOOP>
			</then>
			</if>			
			<TEMPLATEMANAGER.GetTemplateNames PUBID="SessionVariables.pubid" LISTVARNAME="allTemplates"/>
			<SELECT NAME="Template:Called" SIZE="5" MULTIPLE="yes">
				<OPTION VALUE=""/>-<XLAT.STREAM KEY="dvin/AT/Template/ChooseCalledTemplates"/>-
				<LOOP LIST="allTemplates">
					<setvar NAME="selected" VALUE="Variables.isCalledallTemplates.tname"/>
					<if COND="Variables.selected=true">
					<then>
						<OPTION VALUE="allTemplates.tname" SELECTED="true" REPLACEALL="allTemplates.tname"/><STRING.STREAM LIST="allTemplates" COLUMN="name"/>
					</then>
					<else>
						<OPTION VALUE="allTemplates.tname" REPLACEALL="allTemplates.tname"/><STRING.STREAM LIST="allTemplates" COLUMN="name"/>
					</else>
					</if>
				</LOOP>
			</SELECT>
		</td>
	</tr>
</then>
</if>


<!-- Beginning of Group 4 - element catalog info -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>
	<callelement NAME="OpenMarket/Xcelerate/AssetType/Template/ShowElementButtons">
		<argument NAME="currentElement" VALUE="Variables.currentElement"/>
	</callelement>
<!-- rootelement -->
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/Rootelement"/>:</td>
	<td></td>
	<td>
		<IF COND="Variables.updatetype!=setformdefaults">
		<THEN>			
			<![CDATA[<input type="hidden" name="Template:rootelement" value="]]><STRING.STREAM VALUE="Variables.ContentDetails:rootelement"/><![CDATA["/>]]>
			<STRING.STREAM VARIABLE="ContentDetails:element:Variables.currentElement:elementname"/>
		</THEN>
		<ELSE>
			<![CDATA[<input type="text" size="50" maxlength="255" name="Template:rootelement" value="]]><STRING.STREAM VALUE="Variables.ContentDetails:rootelement"/><![CDATA[" onchange="changeRootelement()" />]]>		
		</ELSE>
		</IF>
		<setvar NAME="value" VALUE="Variables.ContentDetails:element:Variables.currentElement:elementname"/>
		<STRING.ENCODE VARIABLE="value" VARNAME="valueEnc"/>
		<INPUT TYPE="hidden" NAME="Template:element:Variables.currentElement:elementname" VALUE="Variables.valueEnc" REPLACEALL="Variables.currentElement,Variables.valueEnc"/>
	</td>
</tr>

<INPUT TYPE="hidden" NAME="currentElementName" VALUE=""/>
<if COND="Variables.ContentDetails:element:Total=0">
<then>
	<setvar NAME="ContentDetails:element:Total" VALUE="1"/>
</then>
</if>
<INPUT TYPE="hidden" NAME="Template:element:Total" VALUE="Variables.ContentDetails:element:Total" REPLACEALL="Variables.ContentDetails:element:Total"/>

<!-- elementdescription -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/ElementCatalogDescription"/>:</td>
	<td></td>
       <setvar NAME="OutputQString"  VALUE="Variables.empty"/>
		<setvar NAME="value" VALUE="Variables.ContentDetails:element:Variables.currentElement:elementdescription"/>
       <STRING.ENCODE VARIABLE="value" VARNAME="OutputQString"/>

	<td> <input type="text" size="50" maxlength="255" name="Template:element:Variables.currentElement:elementdescription"  value="Variables.OutputQString" REPLACEALL="Variables.OutputQString,Variables.currentElement"/></td>
</tr>

<!-- urlspec - element storage -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/ElementCatalogEntryStorPathFn"/>:</td>
	<td></td>
	<td> 
		<setvar NAME="value" VALUE="Variables.ContentDetails:element:Variables.currentElement:urlspec"/>
		<STRING.ENCODE VARIABLE="value" VARNAME="valueEnc"/>
		<input type="text" size="50" maxlength="255" name="Template:element:Variables.currentElement:urlspec" value="Variables.valueEnc" REPLACEALL="Variables.valueEnc,Variables.currentElement" onchange="checkfilename('Template:element:Variables.currentElement:url', 'Template:element:Variables.currentElement:urlspec')"/></td>
</tr>

<!-- url - element logic -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/ElementLogic"/>:</td>
	<td></td>
	<td> <textarea name="Template:element:Variables.currentElement:url" ROWS="25" COLS="50"  WRAP="off" REPLACEALL="Variables.currentElement" onchange="checkfilename('Template:element:Variables.currentElement:url', 'Template:element:Variables.currentElement:urlspec')">
		<STRING.STREAM VARIABLE="ContentDetails:element:Variables.currentElement:url"/>
		</textarea></td>					
</tr>

<!-- resdetails1 -->
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/ElementParameters"/>:<br>(<XLAT.STREAM KEY="dvin/Common/AT/namevaluepairsdelimitedbyamp" ENCODE="false"/>)</br></td>
	<td></td>
	<td>
		<setvar NAME="value" VALUE="Variables.ContentDetails:element:Variables.currentElement:resdetails1"/>
	 <STRING.ENCODE VARIABLE="value" VARNAME="valueEnc"/>
	 <input type="text" size="50" maxlength="255" name="Template:element:Variables.currentElement:resdetails1" value="Variables.valueEnc" REPLACEALL="Variables.valueEnc,Variables.currentElement"/></td>
</tr>
<!-- resdetails2 -->
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacer"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/AT/AdditionalElementParameters"/>:<br>(<XLAT.STREAM KEY="dvin/Common/AT/namevaluepairsdelimitedbyamp" ENCODE="false"/>)</br></td>
	<td></td>
	<td>
		<setvar NAME="value" VALUE="Variables.ContentDetails:element:Variables.currentElement:resdetails2"/>
		<STRING.ENCODE VARIABLE="value" VARNAME="valueEnc"/>
	 <input type="text" size="50" maxlength="255" name="Template:element:Variables.currentElement:resdetails2" value="Variables.valueEnc" REPLACEALL="Variables.valueEnc,Variables.currentElement"/></td>
</tr>

<!-- variants, a.k.a, styles -->

<SETCOUNTER NAME="nthElement" VALUE="0"/>
<SETVAR NAME="errno" VALUE="0"/>
<CALCULATOR.GO VALUE="Variables.ContentDetails:element:Total 1 GT" VARNAME="hasStyles"/>
<IF COND="Variables.hasStyles=1">
<THEN>
<callelement NAME="OpenMarket/Xcelerate/UIFramework/Util/RowSpacerBar"/>
<tr>
	<td class="form-label-text"><XLAT.STREAM KEY="dvin/Common/Variant"/>:</td>
	<td></td>
	<td>
		<if COND="Variables.ContentDetails:element:Total!=0">
		<then>
 			<table>
			<LOOP COUNT="Variables.ContentDetails:element:Total">
				<if COND="Counters.nthElement!=Variables.currentElement">
				<then>
					<setvar NAME="value" VALUE="Variables.ContentDetails:element:Counters.nthElement:elementname"/>
					<XLAT.LOOKUP KEY="dvin/Common/EditThisItem" VARNAME="_XLAT_"/>
					<XLAT.LOOKUP KEY="dvin/Common/EditThisItem"  VARNAME="mouseover" ESCAPE="true"/>
					<tr>
					<td>
               <A HREF="javascript:editElement('Variables.ThisPage', 'ContentFormElement', 'Variables.value')" OnMouseOver="window.status='Variables.mouseover'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.value,Variables.ThisPage,Variables.mouseover">
						<img src="Variables.cs_imagedir/graphics/common/icon/iconEditContent.gif" border="0" hspace="2" vspace="4" ALT="Variables._XLAT_" REPLACEALL="Variables.cs_imagedir,Variables._XLAT_"/>
					</A>
					</td>
					<td>
                <A HREF="javascript:editElement('Variables.ThisPage', 'ContentFormElement', 'Variables.value')" OnMouseOver="window.status='Variables.mouseover'; return true" OnMouseOut="return window.status='';" REPLACEALL="Variables.value,Variables.ThisPage,Variables.mouseover">
						<STRING.STREAM VARIABLE="ContentDetails:element:Counters.nthElement:elementname"/>
					</A>
					</td>
					<td>
 					<XLAT.LOOKUP KEY="dvin/UI/Deletethisitem" VARNAME="_XLAT_"/>
					<XLAT.LOOKUP KEY="dvin/UI/Deletethisitem" VARNAME="mouseover" ESCAPE="true"/>
					<A HREF="javascript:deleteElement('Variables.ThisPage', 'ContentFormElement','Template:element:Counters.nthElement:elementname' )" onmouseover="window.status='Variables.mouseover';return true;" onmouseout="window.status='';return true" REPLACEALL="Variables.ThisPage,Variables.value,Counters.nthElement,Variables.mouseover">
					<img hspace="2" vspace="4" src="Variables.cs_imagedir/graphics/common/icon/iconDeleteContent.gif" border="0" ALT="Variables._XLAT_" REPLACEALL="Variables.cs_imagedir,Variables._XLAT_"/>
					</A>
					</td>
					</tr>
				</then>
				</if>
				<INCCOUNTER NAME="nthElement" VALUE="1"/>
			</LOOP>
			</table>
		</then>
		<else>
				<INCCOUNTER NAME="nthElement" VALUE="1"/>
		</else>
		</if>
		<XLAT.LOOKUP KEY="dvin/AT/Template/AddVariant" VARNAME="addNewVariant"/>
		<!--<input type="text" SIZE="20" MAXLENGTH="32" NAME="Template:element:Counters.nthElement:theme" VALUE="" REPLACEALL="Counters.nthElement"/>-->
		<input type="hidden" name="Template:element:Counters.nthElement:elementname" value="Variables.ContentDetails:rootelement" REPLACEALL="Counters.nthElement,Variables.ContentDetails:rootelement"/>
		<input type="hidden" NAME="Template:element:Counters.nthElement:elementdescription" VALUE="" REPLACEALL="Counters.nthElement"/>
		<input type="hidden" NAME="Template:element:Counters.nthElement:url" VALUE="" REPLACEALL="Counters.nthElement"/>
		<input type="hidden" NAME="Template:element:Counters.nthElement:urlspec" VALUE="" REPLACEALL="Counters.nthElement"/>
		<input type="hidden" NAME="Template:element:Counters.nthElement:resdetails1" VALUE="" REPLACEALL="Counters.nthElement"/>
		<input type="hidden" NAME="Template:element:Counters.nthElementt:resdetails2" VALUE="" REPLACEALL="Counters.nthElement"/>
		<!--&nbsp;<INPUT TYPE="button" NAME="addNewVariant" VALUE="Variables.addNewVariant" onClick="AddVariant('Variables.ThisPage', 'ContentFormElement','Template:element:Counters.nthElement:theme','Template:element:Counters.nthElement:elementname' )" REPLACEALL="Variables.ThisPage,Counters.nthElement,Variables.addNewVariant"/>-->
	</td>
</tr>
</THEN>
</IF>


</table>
</td>
</tr>

	<callelement NAME="OpenMarket/Xcelerate/AssetType/Template/ContentFormFooter">
		<argument NAME="ContinueTo" VALUE="SiteEntry"/>
	</callelement>

</table>


</FTCS>