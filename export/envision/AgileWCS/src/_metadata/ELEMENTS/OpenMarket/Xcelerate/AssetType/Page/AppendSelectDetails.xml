<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">
<FTCS Version="1.1">
<!-- 
$Logfile: /VerticalApps/XcelerateB/install/Xcelerate/Populate/ElementCatalog/OpenMarket/Xcelerate/AssetType/Page/AppendSelectDetails.xml $ 
$Revision: 18 $ 
$Modtime: 8/28/02 12:11p $ 
-->

<!--
- Confidential and Proprietary Information of Open Market, Inc.
-					All Rights Reserved.
-
- DESCRIPTION
-	Complete the sql query based on user's search selections
-   The basic idea: start with a minimum, default
-   query. Then append additional criteria depending
-   on fields that have been selected in the search
-   form
-->


<!-- Set the table name for SQLEXP use -->

	<SETVAR NAME="tablename" VALUE="Page"/>


<if COND="IsVariable.Name=true">
	<then>
		<!--SQLEXP OUTSTR="queryappend" TYPE="OR" VERB="LIKE" STR="Variables.Name" COLNAME="Page.name"/-->
        <!-- support case insensitive search for name field -- 3780 -->         
        <TOLOWER OUTSTR="literal" STR="Variables.Name"/>
        <ics.sqlexp output="queryappend" type="OR" verb="LIKE"  table="Page"
        string="Variables.literal" column="name" expression="lower(Page.name)"/>
     
		<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.queryappend)"/>
 	</then>
</if>

<if COND="IsVariable.Description=true">
	<then>
		<!--SQLEXP OUTSTR="queryappend" TYPE="OR" VERB="LIKE" STR="Variables.Description" COLNAME="Page.description"/-->
        <!-- support case insensitive search for description field -- 3780 -->         
        <TOLOWER OUTSTR="literal" STR="Variables.Description"/>
        <ics.sqlexp output="queryappend" type="OR" verb="LIKE"   table="Page"
        string="Variables.literal" column="description" expression="lower(Page.description)"/>

		<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.queryappend)"/>
 	</then>
</if>

<!-- note that template is a lowercase variable name -->
<if COND="IsVariable.template=true">
    <then>
    
     <ics.literal  table="Page" column="template" string="Variables.template"  output="literal"/>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.template=Variables.literal"/>
    </then>
</if>

<if COND="IsVariable.Subtype=true">
    <then>
    
    <ics.literal  table="Page" column="subtype" string="Variables.Subtype"  output="literal"/>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.subtype=Variables.literal"/>
    </then>
</if>

<if COND="IsVariable.Category=true">
    <then>
     <ics.literal  table="Page" column="category" string="Variables.Category"  output="literal"/>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.category=Variables.literal"/>
    </then>
</if>

<if COND="IsVariable.Status=true">
    <then>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.status='Variables.Status'"/>
    </then>
</if>

<if COND="IsVariable.Id=true">
    <then>
    <SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.id=Variables.Id"/>
     </then>
</if>

<if COND="IsVariable.uId=true">
    <then>
    <SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.fw_uid='Variables.uId'"/>
    <XLAT.LOOKUP KEY="dvin/UI/Search/FWUIDis" VARNAME="_XLAT_"/>

    <SETVAR NAME="filterstring" VALUE="Variables.filterstring : Variables._XLAT_ 'Variables.uId'"/>
     </then>
</if>

<if COND="IsVariable.UpdatedBefore=true">
    <then>
	<if COND="Variables.UpdatedBefore!=Variables.null">
		<then>
		<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.updateddate &#060; Variables.UpdatedBefore"/>
 		</then>
	</if>	
    </then>
</if>

<if COND="IsVariable.UpdatedAfter=true">
    <then>
	<if COND="Variables.UpdatedAfter!=Variables.null">
		<then>
		<SETVAR NAME="queryend" VALUE="Variables.queryend AND Variables.UpdatedAfter &#060; Page.updateddate"/>
 		</then>
	</if>	
    </then>
</if>

<if COND="IsVariable.UpdatedBy=true">
    <then>
    
    <ics.literal  table="Page" column="updatedby" string="Variables.UpdatedBy"  output="literal"/>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND Page.updatedby=Variables.literal"/>
     </then>
</if>

<!-- Add the start date to the query -->
<IF COND="IsVariable.StartDateBefore=true">
<THEN>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.AssetType.startdate &#060; Variables.StartDateBefore OR Variables.AssetType.startdate IS NULL)"/>
</THEN>
</IF>

<IF COND="IsVariable.StartDateAfter=true">
<THEN>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.StartDateAfter &#060; Variables.AssetType.startdate OR Variables.AssetType.startdate IS NULL)"/>
</THEN>
</IF>

<!-- Add the end date to the query -->
<IF COND="IsVariable.EndDateBefore=true">
<THEN>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.AssetType.enddate &#060; Variables.EndDateBefore OR Variables.AssetType.enddate is NULL)"/>
</THEN>
</IF>

<IF COND="IsVariable.EndDateAfter=true">
<THEN>
	<SETVAR NAME="queryend" VALUE="Variables.queryend AND (Variables.EndDateAfter &#060; Variables.AssetType.enddate OR Variables.AssetType.enddate is NULL)"/>
</THEN>
</IF>
    
<IF COND="IsVariable.dimensionssearch=true">
<THEN>
    <SETVAR NAME="queryend" VALUE="Variables.queryend AND Variables.AssetType.id IN (select Variables.AssetType_Dim.cs_ownerid from Variables.AssetType_Dim where Variables.AssetType_Dim.cs_dimensionid=Variables.dimensionssearch)"/>
</THEN>
</IF>

<callelement NAME="OpenMarket/Xcelerate/Actions/Search/BuildFilterString"/>
 
</FTCS>
