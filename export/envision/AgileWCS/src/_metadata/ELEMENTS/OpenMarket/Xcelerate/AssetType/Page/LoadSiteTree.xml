<?xml version="1.0" ?>
<!DOCTYPE FTCS SYSTEM "futuretense_cs.dtd">

<FTCS Version="1.1">
<!-- OpenMarket/Xcelerate/AssetType/Page/LoadSiteTree
-
- INPUT
-
- OUTPUT
-
-->

<IF COND="Variables.command!=GetTypes">
<THEN>

	<!-- decide load root or load non-root -->
	<if COND="Variables.op=init">
	<then>
		<PUBLICATION.LOAD NAME="publication" FIELD="id" VALUE="SessionVariables.pubid"/>
        <!-- pubname is used inside "dvin/TreeApplet/PubnameSite" -->
		<PUBLICATION.GET NAME="publication" FIELD="name" OUTPUT="pubname"/>
		<PUBLICATION.GET NAME="publication" FIELD="description" OUTPUT="pubdesc"/>
		
		<REMOVEVAR NAME="LoadURL"/>
        <REMOVEVAR NAME="ExecuteURL"/>

	<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
		<argument NAME="AdHoc" VALUE="SiteName"/>
		<argument NAME="TreeNodeID" VALUE="Variables.empty"/>
	</callelement>

	<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="TreeOpURL">
		<satellite.argument name="AssetType" value="Variables.AssetType"/>
	</SATELLITE.LINK>

        <XLAT.LOOKUP KEY="dvin/TreeApplet/PubnameSite" ENCODE="false" VARNAME="_XLAT_"/>
		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="Description" VALUE="Variables.pubdesc"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<!-- LoadURL,ExecuteURL implicitly passed in -->
			<ARGUMENT NAME="OpURL" VALUE="Variables.TreeOpURL"/>
			<ARGUMENT NAME="OKActions" VALUE="PlacePage;refresh"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/siteplan.gif"/>
		</CALLELEMENT>
		<!-- make Placed Pages and Unplaced Pages dummy nodes -->
	
		<SITEPLAN.ROOT LIST="PubRoot" OBJECTID="SessionVariables.pubid"/>
	
		<setvar NAME="tablename" VALUE="SitePlanTree"/>
		<execsql LIST="mylist"
			SQL="SELECT COUNT(*) as &#34;mycount&#34;
				FROM  SitePlanTree
				WHERE nparentid = PubRoot.nid 
				AND ncode = 'Placed'"/>
		<REMOVEVAR NAME="LoadURL"/>
        <REMOVEVAR NAME="ExecuteURL"/>
		<IF COND="IsList.mylist=true">
		<THEN>
			<if COND="mylist.mycount!=0">
			<THEN>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
					<satellite.argument name="AssetType" value="Variables.AssetType"/>
					<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/Variables.AssetType/LoadSiteTree"/>
					<satellite.argument name="op" value="load"/>
					<satellite.argument name="loadpages" value="Placed"/>
				</SATELLITE.LINK>
			</THEN>
			</if>
		</THEN>
		</IF>

		<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<argument NAME="AdHoc" VALUE="PlacedPages"/>
			<argument NAME="TreeNodeID" VALUE="Variables.empty"/>
		</callelement>
	
		<REMOVEVAR NAME="Description"/> 
        <XLAT.LOOKUP KEY="dvin/TreeApplet/PlacedPages" ENCODE="false" VARNAME="_XLAT_"/>
		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
		</SATELLITE.LINK>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<!-- LoadURL,ExecuteURL implicitly passed in -->
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
			<ARGUMENT NAME="OKActions" VALUE="PlacePage;refresh"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/placedpage.gif"/>
			<ARGUMENT NAME="RefreshKeys" VALUE="PlacedPages;PubRoot.nid"/>
		</CALLELEMENT>
		
		<setvar NAME="tablename" VALUE="SitePlanTree"/>
		<execsql LIST="mylist"
			SQL="SELECT COUNT(*) as mycount
				FROM  SitePlanTree
				WHERE nparentid = PubRoot.nid 
				AND ncode = 'UnPlaced'"/>
		<REMOVEVAR NAME="LoadURL"/>
        <REMOVEVAR NAME="ExecuteURL"/>
		<IF COND="IsList.mylist=true">
		<THEN>
			<if COND="mylist.mycount!=0">
			<THEN>
				<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
					<satellite.argument name="AssetType" value="Variables.AssetType"/>
					<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/Variables.AssetType/LoadSiteTree"/>
					<satellite.argument name="op" value="load"/>
					<satellite.argument name="loadpages" value="Unplaced"/>
				</SATELLITE.LINK>
			</THEN>
			</if>
		</THEN>
		</IF>

		<callelement NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
			<argument NAME="AdHoc" VALUE="UnplacedPages"/>
			<argument NAME="TreeNodeID" VALUE="Variables.empty"/>
		</callelement>

        <XLAT.LOOKUP KEY="dvin/TreeApplet/UnplacedPages" ENCODE="false" VARNAME="_XLAT_"/>

		<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
			<satellite.argument name="AssetType" value="Variables.AssetType"/>
		</SATELLITE.LINK>

		<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
			<ARGUMENT NAME="Label" VALUE="Variables._XLAT_"/>
			<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
			<!-- LoadURL,ExecuteURL implicitly passed in -->
			<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
 			<ARGUMENT NAME="OKActions" VALUE="refresh"/>
			<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/unplacedpage.gif"/>
			<ARGUMENT NAME="RefreshKeys" VALUE="UnplacedPages"/>
		</CALLELEMENT>
		
	</then>
	<else>
		<if COND="Variables.loadpages=Placed">
		<then>
			<!-- expand the Placed Pages dummy node -->
			  <SITEPLAN.ROOT LIST="PubRoot" OBJECTID="SessionVariables.pubid"/>
			<SITEPLAN.LOAD NAME="thePubNode" NODEID="PubRoot.nid"/>
			<SITEPLAN.CHILDREN NAME="thePubNode" LIST="children" CODE="Placed" ORDER="nrank"/>
			
			<IF COND="IsList.children=true">
			<THEN>
				<IF COND="children.#numRows!=0">
				<THEN>
					<LOOP LIST="children">
						<SITEPLAN.LOAD NAME="thePage" NODEID="children.nid"/>
						<ASSET.LOAD NAME="currentChild" TYPE="children.otype" OBJECTID="children.oid"/>
						<ASSET.GET NAME="currentChild" FIELD="name" OUTPUT="currentName"/>
						<ASSET.GET NAME="currentChild" FIELD="description" OUTPUT="currentDesc"/>
						<SITEPLAN.CHILDREN NAME="thePage" LIST="grandchildren" CODE="Placed" ORDER="nrank"/>
						<ASSET.CHILDREN NAME="currentChild" LIST="relatedchildren"/>
						
						<REMOVEVAR NAME="LoadURL"/>
						<IF COND="IsList.grandchildren=true">
						<THEN>
							<IF COND="grandchildren.#numRows!=0">
							<THEN>
								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
									<satellite.argument name="AssetType" value="children.otype"/>
									<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
									<satellite.argument name="op" value="load"/>
									<satellite.argument name="loadpages" value="children.nid"/>
								</SATELLITE.LINK>
							</THEN>
							</IF>
						</THEN>
						</IF>
						<IF COND="IsList.relatedchildren=true">
						<THEN>
							<IF COND="relatedchildren.#numRows!=0">
							<THEN>
								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
									<satellite.argument name="AssetType" value="children.otype"/>
									<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
									<satellite.argument name="op" value="load"/>
									<satellite.argument name="loadpages" value="children.nid"/>
								</SATELLITE.LINK>
							</THEN>
							</IF>
						</THEN>
						</IF>
						
						<SETVAR NAME="oldat" VALUE="Variables.AssetType"/>
						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
							<ARGUMENT NAME="ID" VALUE="children.oid"/>
							<ARGUMENT NAME="AssetType" VALUE="children.otype"/>
							<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
						</CALLELEMENT>
						<SETVAR NAME="AssetType" VALUE="Variables.oldat"/>
						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ExecuteURL">
							<satellite.argument name="AssetType" value="children.otype"/>
							<satellite.argument name="n0_" value="Variables.TreeNodeID"/>
							<satellite.argument name="op" value="displayNode"/>
						</SATELLITE.LINK>

						<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
							<satellite.argument name="AssetType" value="children.otype"/>
						</SATELLITE.LINK>

                        <REMOVEVAR NAME="PreviewURL"/>
                        <PREVIEWURL.MAKEURL VARNAME="PreviewURL" ASSETTYPE="children.otype" ASSETID="children.oid" PUBID="SessionVariables.pubid"/>

						<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
							<ARGUMENT NAME="Label" VALUE="Variables.currentName"/>
							<ARGUMENT NAME="Description" VALUE="Variables.currentDesc"/>
							<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
							<!-- LoadURL implicitly passed in -->
							<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
							<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
                            <!-- PreviewURL implicitly passed in -->
							<ARGUMENT NAME="OKActions" VALUE="Status;Inspect;Edit;Preview;Delete;PlacePage;refresh"/>
							<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/children.otype.gif"/>
							<ARGUMENT NAME="RefreshKeys" VALUE="children.oid;children.nid"/>
						</CALLELEMENT>
					</LOOP>
				</THEN>
				</IF>
			</THEN>
			</IF>
		</then>
		<else>
			<if COND="Variables.loadpages=Unplaced">
			<then>
				<!-- expand the Unplaced Pages dummy node -->
				<SITEPLAN.ROOT LIST="PubRoot" OBJECTID="SessionVariables.pubid"/>
				<SITEPLAN.LOAD NAME="thePubNode" NODEID="PubRoot.nid"/>
				<SITEPLAN.CHILDREN NAME="thePubNode" LIST="children" CODE="UnPlaced" ORDER="nrank"/>
				
				<IF COND="IsList.children=true">
				<THEN>
					<IF COND="children.#numRows!=0">
					<THEN>
						<LOOP LIST="children">
							<SITEPLAN.LOAD NAME="thePage" NODEID="children.nid"/>
							<ASSET.LOAD NAME="currentChild" TYPE="children.otype" OBJECTID="children.oid"/>
							<ASSET.GET NAME="currentChild" FIELD="name" OUTPUT="currentName"/>
							<ASSET.GET NAME="currentChild" FIELD="description" OUTPUT="currentDesc"/>
							<SITEPLAN.CHILDREN NAME="thePage" LIST="grandchildren" ORDER="nrank"/>
							<ASSET.CHILDREN NAME="currentChild" LIST="relatedchildren"/>
							
							<REMOVEVAR NAME="LoadURL"/>
							<IF COND="IsList.grandchildren=true">
							<THEN>
								<IF COND="grandchildren.#numRows!=0">
								<THEN>
									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
										<satellite.argument name="AssetType" value="children.otype"/>
										<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
										<satellite.argument name="op" value="load"/>
										<satellite.argument name="loadpages" value="children.nid"/>
									</SATELLITE.LINK>
								</THEN>
								</IF>
							</THEN>
							</IF>
							<IF COND="IsList.relatedchildren=true">
							<THEN>
								<IF COND="relatedchildren.#numRows!=0">
								<THEN>
									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
										<satellite.argument name="AssetType" value="children.otype"/>
										<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
										<satellite.argument name="op" value="load"/>
										<satellite.argument name="loadpages" value="children.nid"/>
									</SATELLITE.LINK>
								</THEN>
								</IF>
							</THEN>
							</IF>
							
							<SETVAR NAME="oldat" VALUE="Variables.AssetType"/>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="ID" VALUE="children.oid"/>
								<ARGUMENT NAME="AssetType" VALUE="children.otype"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>
							<SETVAR NAME="AssetType" VALUE="Variables.oldat"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ExecuteURL">
								<satellite.argument name="AssetType" value="children.otype"/>
								<satellite.argument name="n0_" value="Variables.TreeNodeID"/>
								<satellite.argument name="op" value="displayNode"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="children.otype"/>
							</SATELLITE.LINK>

                            <REMOVEVAR NAME="PreviewURL"/>
                            <PREVIEWURL.MAKEURL VARNAME="PreviewURL" ASSETTYPE="children.otype" ASSETID="children.oid" PUBID="SessionVariables.pubid"/>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables.currentName"/>
								<ARGUMENT NAME="Description" VALUE="Variables.currentDesc"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<!-- LoadURL implicitly passed in -->
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
                                <!-- PreviewURL implicitly passed in -->
								<ARGUMENT NAME="OKActions" VALUE="Status;Inspect;Edit;Preview;Delete;refresh"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/children.otype.gif"/>
								<ARGUMENT NAME="RefreshKeys" VALUE="children.oid;children.nid"/>
							</CALLELEMENT>
						</LOOP>
					</THEN>
					</IF>
				</THEN>
				</IF>
			</then>
			<else>
				<!-- expand an actual asset node -->
				<!-- if asset type can be part of the SitePlanTree (Page right now) then
					 need to get site children and also asset children.  For other types
					 we just need asset children. -->
				
				<SETVAR NAME="assetid" VALUE="Variables.loadpages"/>
				
				<!-- for now hardcode Page check until I know how to distinguish -->
					
				<IF COND="Variables.AssetType=Page">
				<THEN>
					<SITEPLAN.LOAD NAME="thePage" NODEID="Variables.assetid"/>
					<SITEPLAN.GET NAME="thePage" FIELD="oid" OUTPUT="assetid"/>
						 <SITEPLAN.CHILDREN NAME="thePage" LIST="children" ORDER="nrank"/>
					
					<IF COND="IsList.children=true">
					<THEN>
						<IF COND="children.#numRows!=0">
						<THEN>
							<LOOP LIST="children">
								<SITEPLAN.LOAD NAME="thePage" NODEID="children.nid"/>
								<ASSET.LOAD NAME="currentChild" TYPE="children.otype" OBJECTID="children.oid"/>
								<ASSET.GET NAME="currentChild" FIELD="name" OUTPUT="currentName"/>
								<ASSET.GET NAME="currentChild" FIELD="description" OUTPUT="currentDesc"/>
								<SITEPLAN.CHILDREN NAME="thePage" LIST="grandchildren" ORDER="nrank"/>
								<!-- detect whether we are in Placed or Unplaced section of tree -->
								<SITEPLAN.NODEPATH NAME="thePage" LIST="myAncestors"/>
								<GOTOROW LIST="myAncestors" ROWNUM="myAncestors.#numRows"/>
								<SETROW LIST="myAncestors" ACTION="PREV"/>
								<if COND="myAncestors.ncode=UnPlaced">
								<then>
									<setvar NAME="OKActions" VALUE="Status;Inspect;Edit;Preview;Delete;refresh"/>
								</then>
								<else>
									<setvar NAME="OKActions" VALUE="Status;Inspect;Edit;Preview;Delete;PlacePage;refresh"/>
								</else>
								</if>								
								<REMOVEVAR NAME="LoadURL"/>
								<IF COND="IsList.grandchildren=true">
								<THEN>
									<IF COND="grandchildren.#numRows!=0">
									<THEN>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
											<satellite.argument name="AssetType" value="children.otype"/>
											<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
											<satellite.argument name="op" value="load"/>
											<satellite.argument name="loadpages" value="children.nid"/>
										</SATELLITE.LINK>
									</THEN>
									</IF>
								</THEN>
								</IF>
								<ASSET.CHILDREN NAME="currentChild" LIST="grandchildren"/>
								<IF COND="IsList.grandchildren=true">
								<THEN>
									<IF COND="grandchildren.#numRows!=0">
									<THEN>
										<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
											<satellite.argument name="AssetType" value="children.otype"/>
											<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/children.otype/LoadSiteTree"/>
											<satellite.argument name="op" value="load"/>
											<satellite.argument name="loadpages" value="children.nid"/>
										</SATELLITE.LINK>
									</THEN>
									</IF>
								</THEN>
								</IF>
								
								<SETVAR NAME="oldat" VALUE="Variables.AssetType"/>
								<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
									<ARGUMENT NAME="ID" VALUE="children.oid"/>
									<ARGUMENT NAME="AssetType" VALUE="children.otype"/>
									<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
								</CALLELEMENT>
								<SETVAR NAME="AssetType" VALUE="Variables.oldat"/>

								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ExecuteURL">
									<satellite.argument name="AssetType" value="children.otype"/>
									<satellite.argument name="n0_" value="Variables.TreeNodeID"/>
									<satellite.argument name="op" value="displayNode"/>
								</SATELLITE.LINK>

								<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
									<satellite.argument name="AssetType" value="children.otype"/>
								</SATELLITE.LINK>

                                <REMOVEVAR NAME="PreviewURL"/>
                                <PREVIEWURL.MAKEURL VARNAME="PreviewURL" ASSETTYPE="children.otype" ASSETID="children.oid" PUBID="SessionVariables.pubid"/>

								<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
									<ARGUMENT NAME="Label" VALUE="Variables.currentName"/>
									<ARGUMENT NAME="Description" VALUE="Variables.currentDesc"/>
									<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
									<!-- LoadURL implicitly passed in -->
									<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
									<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
                                    <!-- PreviewURL implicitly passed in -->
									<ARGUMENT NAME="OKActions" VALUE="Variables.OKActions"/>
									<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/children.otype.gif"/>
									<ARGUMENT NAME="RefreshKeys" VALUE="children.oid;children.nid"/>
								</CALLELEMENT>
							</LOOP>
						</THEN>
						</IF>
					</THEN>
					</IF>
				</THEN>
				</IF>
				
				<ASSET.LOAD NAME="ainst" TYPE="Variables.AssetType" OBJECTID="Variables.assetid"/>
				<ASSET.CHILDREN NAME="ainst" LIST="archildren" ORDER="otype,ncode desc,nrank asc"/>
					<IF COND="IsList.archildren=true">
				<THEN>
					<IF COND="archildren.#numRows!=0">
					<THEN>
						<LOOP LIST="archildren">
							<ASSET.LOAD NAME="currentChild" TYPE="archildren.otype" OBJECTID="archildren.oid"/>
							<ASSET.GET NAME="currentChild" FIELD="name" OUTPUT="currentName"/>
							<ASSET.GET NAME="currentChild" FIELD="description" OUTPUT="currentDesc"/>
							<ASSET.CHILDREN NAME="currentChild" LIST="argrandchildren"/>
							
							<REMOVEVAR NAME="LoadURL"/>
							<IF COND="IsList.argrandchildren=true">
							<THEN>
								<IF COND="argrandchildren.#numRows!=0">
								<THEN>
									<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/LoadTab" outstring="LoadURL">
										<satellite.argument name="AssetType" value="archildren.otype"/>
										<satellite.argument name="populate" value="OpenMarket/Xcelerate/AssetType/archildren.otype/LoadSiteTree"/>
										<satellite.argument name="op" value="load"/>
										<satellite.argument name="assetid" value="archildren.oid"/>
										<satellite.argument name="loadpages" value="archildren.oid"/>
									</SATELLITE.LINK>
								</THEN>
								</IF>
							</THEN>
							</IF>
							<SETVAR NAME="oldat" VALUE="Variables.AssetType"/>
							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNodeID" SCOPED="STACKED">
								<ARGUMENT NAME="ID" VALUE="archildren.oid"/>
								<ARGUMENT NAME="AssetType" VALUE="archildren.otype"/>
								<ARGUMENT NAME="TreeNodeID" VALUE="Variables.empty"/>
							</CALLELEMENT>
							<SETVAR NAME="AssetType" VALUE="Variables.oldat"/>
							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="ExecuteURL">
								<satellite.argument name="AssetType" value="archildren.otype"/>
								<satellite.argument name="n0_" value="Variables.TreeNodeID"/>
								<satellite.argument name="op" value="displayNode"/>
							</SATELLITE.LINK>

							<SATELLITE.LINK ASSEMBLER="query" pagename="OpenMarket/Gator/UIFramework/TreeOpURL" outstring="OpURL">
								<satellite.argument name="AssetType" value="archildren.otype"/>
							</SATELLITE.LINK>

                            <REMOVEVAR NAME="PreviewURL"/>
                            <PREVIEWURL.MAKEURL VARNAME="PreviewURL" ASSETTYPE="archildren.otype" ASSETID="archildren.oid" PUBID="SessionVariables.pubid"/>

							<CALLELEMENT NAME="OpenMarket/Gator/UIFramework/BuildTreeNode">
								<ARGUMENT NAME="Label" VALUE="Variables.currentName"/>
								<ARGUMENT NAME="Description" VALUE="Variables.currentDesc"/>
								<ARGUMENT NAME="ID" VALUE="Variables.TreeNodeID"/>
								<!-- LoadURL implicitly passed in -->
								<ARGUMENT NAME="OpURL" VALUE="Variables.OpURL"/>
								<ARGUMENT NAME="ExecuteURL" VALUE="Variables.ExecuteURL"/>
                                <!-- PreviewURL implicitly passed in -->
								<ARGUMENT NAME="OKActions" VALUE="Status;Inspect;Edit;Preview;Delete;refresh"/>
								<ARGUMENT NAME="Image" VALUE="Variables.cs_imagedir/OMTree/TreeImages/AssetTypes/archildren.otype.gif"/>
								<ARGUMENT NAME="RefreshKeys" VALUE="archildren.oid"/>
							</CALLELEMENT>
						</LOOP>
					</THEN>
					</IF>
				</THEN>
				</IF>
			</else>
			</if>
		</else>
		</if>
	</else>
	</if>
</THEN>
<ELSE>
	<SETVAR NAME="Variables.varname" VALUE="Variables.AssetType"/>
</ELSE>
</IF>

</FTCS> 
